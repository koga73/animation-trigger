/*
* animation-trigger v1.0.0 Copyright (c) 2020 AJ Savino
* https://github.com/koga73/animation-trigger
* MIT License
*/
var AnimationTrigger=function(e){e=e||document;var u=null,v={events:!0,eventChangeVisible:"animation-trigger-visible",eventChangeActive:"animation-trigger-active",attributeAnimTrig:"data-animation-trigger",classVisible:"animation-trigger-visible",classActive:"animation-trigger-active",scrollDebounce:200,_el:null,_animEls:[],_animElsBounds:[],_resizer:null,_scrollTimeout:0},_={init:function(e){v._el=e,"undefined"!=typeof Resizer&&(v._resizer=new Resizer({onResize:_._handler_resize})),u.updateCache(),u.evalVisibility(),u.evalActive(),v._el.addEventListener("scroll",_._handler_scroll)},destroy:function(){v._el.removeEventListener("scroll",_._handler_scroll),clearTimeout(v._scrollTimeout),v._resizer&&(v._resizer.destroy(),v._resizer=null),v._animElsBounds=[],v._animEls=[],v._el=null},getEls:function(){return v._animEls},getVisible:function(){return v._el.querySelectorAll("."+u.classVisible)},getActive:function(){return v._el.querySelector("."+u.classActive)},updateCache:function(){if(v._animEls=v._el.querySelectorAll("["+u.attributeAnimTrig+"]"),"undefined"==typeof Resizer)return console.warn("Resizer excluded - cache disabled"),void(v._animElsBounds=null);v._animElsBounds=[];for(var e=0;e<v._animEls.length;e++){var i=v._animEls[e];v._animElsBounds.push(_._getBounds(i))}},_getBounds:function(e){return[e.offsetLeft,e.offsetTop,e.offsetLeft+e.clientWidth,e.offsetTop+e.clientHeight]},isVisible:function(e){var i,t=_._getScrollBounds(),s=-1;if(v._animElsBounds)for(var l=0;l<v._animEls.length;l++)if(v._animEls[l]==e){s=l;break}var n=(i=-1!=s?v._animElsBounds[s]:_._getBounds(e))[0]>=t[0]&&i[0]<=t[2]||i[2]>=t[0]&&i[2]<=t[2],a=i[1]>=t[1]&&i[1]<=t[3]||i[3]>=t[1]&&i[3]<=t[3];return n&&a},_handler_scroll:function(e){v._scrollTimeout&&clearTimeout(v._scrollTimeout),v._scrollTimeout=setTimeout(_._handler_scroll_timeout,u.scrollDebounce)},_handler_scroll_timeout:function(){clearTimeout(v._scrollTimeout),u.evalVisibility(),u.evalActive()},_handler_resize:function(e,i){u.updateCache(),u.evalVisibility(),u.evalActive()},_getScrollBounds:function(){if(v._el!=document)return[v._el.scrollLeft,v._el.scrollTop,v._el.scrollLeft,v._el.scrollLeft];var e=document.body.scrollLeft||document.documentElement.scrollLeft,i=document.body.scrollTop||document.documentElement.scrollTop;return[e,i,e+window.innerWidth,i+window.innerHeight]},evalActive:function(){for(var e=_._getScrollBounds(),i=[e[0]+Math.abs(e[2]-e[0]),e[1]+Math.abs(e[3]-e[1])],t=-1,s=-1,l=0;l<v._animEls.length;l++){var n,a=v._animEls[l],o=[(n=v._animElsBounds?v._animElsBounds[l]:_._getBounds(a))[0]+Math.abs(n[2]-n[0]),n[1]+Math.abs(n[3]-n[1])],r=[Math.abs(i[0]-o[0]),Math.abs(i[1]-o[1])],c=Math.sqrt(Math.pow(r[0],2)+Math.pow(r[1],2));(-1==s||c<s)&&(s=c,t=l)}for(l=0;l<v._animEls.length;l++){a=v._animEls[l];l==t?a.classList.contains(u.classActive)||(a.classList.add(u.classActive),u.events&&a.dispatchEvent(new CustomEvent(u.eventChangeActive,{detail:{isActive:!0}}))):a.classList.contains(u.classActive)&&(a.classList.remove(u.classActive),u.events&&a.dispatchEvent(new CustomEvent(u.eventChangeActive,{detail:{isActive:!1}})))}},evalVisibility:function(){for(var e=[],i=[],t=0;t<v._animEls.length;t++){var s=v._animEls[t];u.isVisible(s)?(s.classList.contains(u.classVisible)||(s.classList.add(u.classVisible),e.push({el:s,isVisible:!0})),i.push(s)):s.classList.contains(u.classVisible)&&(s.classList.remove(u.classVisible),e.push({el:s,isVisible:!1}))}if(u.events)for(t=0;t<e.length;t++){var l=e[t];l.el.dispatchEvent(new CustomEvent(u.eventChangeVisible,{detail:{isVisible:l.isVisible}}))}}};return(u={events:v.events,eventChangeVisible:v.eventChangeVisible,eventChangeActive:v.eventChangeActive,attributeAnimTrig:v.attributeAnimTrig,classVisible:v.classVisible,classActive:v.classActive,scrollDebounce:v.scrollDebounce,init:_.init,destroy:_.destroy,getEls:_.getEls,getVisible:_.getVisible,getActive:_.getActive,updateCache:_.updateCache,isVisible:_.isVisible,evalVisibility:_.evalVisibility,evalActive:_.evalActive}).init(e),u};