/*
* animation-trigger v1.0.0 Copyright (c) 2020 AJ Savino
* https://github.com/koga73/animation-trigger
* MIT License
*/
var AnimationTrigger=function(e){var _=null,u={attributeAnimTrig:AnimationTrigger.DEFAULT_ATTRIBUTE_ANIM_TRIG,events:!0,eventChangeVisible:AnimationTrigger.DEFAULT_EVENT_CHANGE_VISIBLE,eventChangeActive:AnimationTrigger.DEFAULT_EVENT_CHANGE_ACTIVE,classVisible:AnimationTrigger.DEFAULT_CLASS_VISIBLE,classActive:AnimationTrigger.DEFAULT_CLASS_ACTIVE,scrollDebounce:200,_el:null,_animEls:[],_animElsBounds:[],_resizer:null,_scrollTimeout:0},v={init:function(e){e=e||document,u._el=e,"undefined"!=typeof Resizer&&(u._resizer=new Resizer({onResize:v._handler_resize})),_.updateEls(),_.evalVisibility(),_.evalActive()},destroy:function(){u._el.removeEventListener("scroll",v._handler_scroll),clearTimeout(u._scrollTimeout),u._resizer&&(u._resizer.destroy(),u._resizer=null),u._animElsBounds=[],u._animEls=[],u._el=null},getEls:function(){return u._animEls},getVisible:function(){return u._el.querySelectorAll("."+_.classVisible)},getActive:function(){return u._el.querySelector("."+_.classActive)},updateEls:function(){if(u._animEls=u._el.querySelectorAll("["+_.attributeAnimTrig+"]"),u._animEls.length?u._el.addEventListener("scroll",v._handler_scroll):u._el.removeEventListener("scroll",v._handler_scroll),!u._resizer)return console.warn("Resizer excluded - cache disabled"),void(u._animElsBounds=null);u._animElsBounds=[];for(var e=0;e<u._animEls.length;e++){var i=u._animEls[e];u._animElsBounds.push(v._getBounds(i))}},_getBounds:function(e){return[e.offsetLeft,e.offsetTop,e.offsetLeft+e.clientWidth,e.offsetTop+e.clientHeight]},isVisible:function(e){var i,t=v._getScrollBounds(),l=-1;if(u._animElsBounds)for(var s=0;s<u._animEls.length;s++)if(u._animEls[s]==e){l=s;break}var n=(i=-1!=l?u._animElsBounds[l]:v._getBounds(e))[0]>=t[0]&&i[0]<=t[2]||i[2]>=t[0]&&i[2]<=t[2],r=i[1]>=t[1]&&i[1]<=t[3]||i[3]>=t[1]&&i[3]<=t[3];return n&&r},_handler_scroll:function(e){u._scrollTimeout&&clearTimeout(u._scrollTimeout),u._scrollTimeout=setTimeout(v._handler_scroll_timeout,_.scrollDebounce)},_handler_scroll_timeout:function(){clearTimeout(u._scrollTimeout),_.evalVisibility(),_.evalActive()},_handler_resize:function(e,i){_.updateEls(),_.evalVisibility(),_.evalActive()},_getScrollBounds:function(){if(u._el!=document)return[u._el.scrollLeft,u._el.scrollTop,u._el.scrollLeft,u._el.scrollLeft];var e=document.body.scrollLeft||document.documentElement.scrollLeft,i=document.body.scrollTop||document.documentElement.scrollTop;return[e,i,e+window.innerWidth,i+window.innerHeight]},evalActive:function(){for(var e=v._getScrollBounds(),i=[e[0]+Math.abs(e[2]-e[0]),e[1]+Math.abs(e[3]-e[1])],t=-1,l=-1,s=0;s<u._animEls.length;s++){var n,r=u._animEls[s],a=[(n=u._animElsBounds?u._animElsBounds[s]:v._getBounds(r))[0]+Math.abs(n[2]-n[0]),n[1]+Math.abs(n[3]-n[1])],o=[Math.abs(i[0]-a[0]),Math.abs(i[1]-a[1])],c=Math.sqrt(Math.pow(o[0],2)+Math.pow(o[1],2));(-1==l||c<l)&&(l=c,t=s)}for(s=0;s<u._animEls.length;s++){r=u._animEls[s];s==t?r.classList.contains(_.classActive)||(r.classList.add(_.classActive),_.events&&r.dispatchEvent(new CustomEvent(_.eventChangeActive,{detail:{isActive:!0}}))):r.classList.contains(_.classActive)&&(r.classList.remove(_.classActive),_.events&&r.dispatchEvent(new CustomEvent(_.eventChangeActive,{detail:{isActive:!1}})))}},evalVisibility:function(){for(var e=[],i=[],t=0;t<u._animEls.length;t++){var l=u._animEls[t];_.isVisible(l)?(l.classList.contains(_.classVisible)||(l.classList.add(_.classVisible),e.push({el:l,isVisible:!0})),i.push(l)):l.classList.contains(_.classVisible)&&(l.classList.remove(_.classVisible),e.push({el:l,isVisible:!1}))}if(_.events)for(t=0;t<e.length;t++){var s=e[t];s.el.dispatchEvent(new CustomEvent(_.eventChangeVisible,{detail:{isVisible:s.isVisible}}))}}};_={attributeAnimTrig:u.attributeAnimTrig,events:u.events,eventChangeVisible:u.eventChangeVisible,eventChangeActive:u.eventChangeActive,classVisible:u.classVisible,classActive:u.classActive,scrollDebounce:u.scrollDebounce,init:v.init,destroy:v.destroy,getEls:v.getEls,getVisible:v.getVisible,getActive:v.getActive,updateEls:v.updateEls,isVisible:v.isVisible,evalVisibility:v.evalVisibility,evalActive:v.evalActive};var i=null;if(e){for(var t in e)_[t]=e[t];i=t.el||null}return _.init(i),_};AnimationTrigger.DEFAULT_ATTRIBUTE_ANIM_TRIG="data-animation-trigger",AnimationTrigger.DEFAULT_EVENT_CHANGE_VISIBLE="animation-trigger-visible",AnimationTrigger.DEFAULT_EVENT_CHANGE_ACTIVE="animation-trigger-active",AnimationTrigger.DEFAULT_CLASS_VISIBLE="animation-trigger-visible",AnimationTrigger.DEFAULT_CLASS_ACTIVE="animation-trigger-active",window.AnimationTrigger=AnimationTrigger;